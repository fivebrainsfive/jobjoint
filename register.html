<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register - JobJoint</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

  <script>
    // ✅ Initialize Firebase (same as login page)
    const firebaseConfig = {
      apiKey: "AIzaSyCRJWxKrUMpSd8yUPnPzPcBGu3tlkklCok",
      authDomain: "jobjoint-92df5.firebaseapp.com",
      projectId: "jobjoint-92df5",
      storageBucket: "jobjoint-92df5.firebasestorage.app",
      messagingSenderId: "457361834077",
      appId: "1:457361834077:web:3101303905ad8c39114db4",
      measurementId: "G-5SMBJLS37B"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
</head>
<body>
  <header>
    <h1>Register - JobJoint</h1>
  </header>

  <div class="container">
    <h2>Create your account</h2>

    <input type="text" id="name" placeholder="Full Name" />
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password (min 6 characters)" />
    
    <label for="role">Select your role:</label>
    <select id="role">
      <option value="">-- Select Role --</option>
      <option value="worker">Worker</option>
      <option value="graduate">Graduate</option>
    </select>

    <button id="registerBtn" onclick="register()">Register</button>

    <p id="errorMsg" style="color: red;"></p>
    <p id="successMsg" style="color: green;"></p>

    <p>Already have an account? <a href="login.html">Login here</a></p>
  </div>

  <script>
    async function register() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;
      const errorMsg = document.getElementById("errorMsg");
      const successMsg = document.getElementById("successMsg");
      const registerBtn = document.getElementById("registerBtn");

      errorMsg.innerText = "";
      successMsg.innerText = "";
      registerBtn.disabled = true;
      registerBtn.innerText = "Registering...";

      // ✅ Basic validation
      if (!name || !email || !password || !role) {
        errorMsg.innerText = "Please fill in all fields.";
        registerBtn.disabled = false;
        registerBtn.innerText = "Register";
        return;
      }

      if (password.length < 6) {
        errorMsg.innerText = "Password must be at least 6 characters long.";
        registerBtn.disabled = false;
        registerBtn.innerText = "Register";
        return;
      }

      try {
        // ✅ Create user
        const credential = await auth.createUserWithEmailAndPassword(email, password);
        const user = credential.user;

        // ✅ Save user info to Firestore
        await db.collection("users").doc(user.uid).set({
          name,
          email,
          role,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ✅ Send email verification
        await user.sendEmailVerification();

        successMsg.innerText = "Registration successful! Please check your email for verification before logging in.";
        registerBtn.innerText = "Registered!";
        registerBtn.disabled = true;
      } catch (err) {
        errorMsg.innerText = "Registration failed: " + err.message;
        registerBtn.disabled = false;
        registerBtn.innerText = "Register";
      }
    }
  </script>
</body>
</html>
